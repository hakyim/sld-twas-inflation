{
  "hash": "938179375ba491b84073c86c6a19c53c",
  "result": {
    "markdown": "---\nformat:\n  revealjs:\n    slide-number: c/t\n    width: 1600\n    height: 900\n    css: [\"theme/theme.css\"]\n    theme: [simple,theme/mystyle.scss]\n    echo: true\neditor: source\nfreeze: true\npdf-separate-fragments: true\n---\n\n\n# On the Problem of Inflation in TWAS {background-color=\"white\"}\n<br>\n\n<h2>STATGEN 2024, Pittsburgh</h2>\n\n<!-- <h4>Session: Identification of causal molecular phenotypes underlying complex diseases using multi-omics QTL data</h4> -->\n\n<h3>2023-05-01 Wednesday</h3>\n\n<h3>Hae Kyung Im</h3>\n\n\n## What is TWAS?{.nostretch background-image=assets/slide-background.svg}\n\n. . . \n\n<br>\nIt's a method that tries to identify causal genes of GWAS loci\n\n. . . \n\n<br>\nGWAS discoveries continue to grow but causal genes are not known\n\n\n![](assets/gwas-catalog-2024-04-10.png){width=50%}\n\n<small>downloaded April 2024 from GWAS Catalog </small>\n\n\n## TWAS uses GWAS data to find genes associated with trait {background-image=assets/slide-background.svg}\n\n![](assets/gwas-predixcan-diagram){width=1200}\n\n::: {.absolute bottom=0 left=0 .fragment .fade-out}\n![](assets/blank-rectangle.png){width=\"1600\" height=\"380\" fig-alt=\"blank\"}\n:::\n\n\n\n\n<!-- :::{.absolute bottom=200 left=1200 .fragment .fade-in} -->\n<!-- :::{.fragment .fade-out} -->\n\n<!-- - RNA-Seq is too expensive -->\n<!-- - Many tissues such has brain, pancreas, etc are not accessible -->\n<!-- - Differentially expressed genes can be consequence of disease status -->\n\n<!-- ::: -->\n<!-- ::: -->\n\n<!-- ::: {.absolute bottom=0 left=0 .fragment .fade-out} -->\n<!-- ![](assets/blank-rectangle.png){width=\"370\" height=\"440\" fig-alt=\"blank\"} -->\n<!-- ::: -->\n\n<!-- ::: {.absolute bottom=260 left=360 .fragment .fade-out} -->\n<!-- ![](assets/blank-rectangle.png){width=\"110\" height=\"30\" fig-alt=\"blank\"} -->\n<!-- ::: -->\n\n<!-- ::: {.absolute bottom=210 left=720 .fragment .fade-out} -->\n<!-- ![](assets/blank-rectangle.png){width=\"210\" height=\"50\" fig-alt=\"blank\"} -->\n<!-- ::: -->\n\n## Gene expression can be predicted from genotype {background-image=assets/slide-background.svg}\n\n![](assets/reference-transcriptome-gtex.png)\n\n## Some genes are very well predicted {background-image=assets/slide-background.svg}\n\n![](assets/performance-top-genes.png)\n\n## Accuracy of prediction depends on heritability {.nostretch  background-image=assets/slide-background.svg}\n\n![](assets/performance-all-genes.png){width=75%}\n\n\n## Advantages of gene level associations {background-image=assets/slide-background.svg visibility=hidden}\n\n- Reduced multiple testing burden (from 10e6 to 10e4)\n- The function of genes are much better annotated than SNPs\n- Validation in other model systems is possible\n- Reverse causality issues is less problematic because disease status doesn’t affect germline genetic markers \n- It provides the direction of effects, i.e. whether up or down regulation of a gene - increases the risk of a disease\n- The candidate causal gene is a good target for drug development\n\n## PrediXcan results identify drug repositioning candidates {\n.nostretch \nbackground-image=assets/slide-background.svg \nvisibility=hidden\n}\n\n![](assets/so-drug-repurposing.png){width=75%}\n\n:::aside\nSo et al, Nature Neuroscience 2017\n::: \n\n## PrediXcan Results Are Predictive of Drug Target Success {\nbackground-image=assets/slide-background.svg\nvisibility=hidden}\n\n![](assets/successful-drugs-higher-twas-signal.png)\n\n## Limitations of TWAS  {\nbackground-image=assets/slide-background.svg \nvisibility=hidden\n}\n\n:::{.columns}\n\n:::{.column width=75%}\n\n- Not very good at predicting low heritability genes which are more likely to be disease relevant\n- Predictions don’t transfer well across ancestries\n- Effect of rare variation is missed\n- Steady state eQTL may not be disease relevant\n\n:::\n:::\n\n## TWAS extensions are actively being developed {background-image=assets/slide-background.svg .nostretch }\n\n![](assets/omnixcan.png){width=80%}\n\n. . . \n\nit uses genetic predictors of omic traits to bridge the gap between genotype and phenotype\n\n## Leeuw et al questioned the validity of TWAS  {background-image=assets/slide-background.svg}\n\n:::{.columns}\n\n:::{.column width=70%}\n\n![](assets/leeuws-twas-validity.png)\n\n:::\n\n:::{.column width=30%}\n\n<br>\n<br>\n<br>\nLeewu et al claim that noise in predictors cause inflation of TWAS\n\n:::\n\n:::\n\n<!-- ## Why should we worry about inflation? {background-image=assets/slide-background.svg} -->\n\n<!-- . . . -->\n\n<!-- <br> -->\n<!-- <br> -->\n\n<!-- <center> -->\n\n<!-- because none of the *WAS results would be valid -->\n\n<!-- </center> -->\n\n<!-- ## Hey, type I error is important but I care more about power  {background-image=assets/slide-background.svg} -->\n\n\n<!-- . . . -->\n\n<!-- <br> -->\n<!-- <br> -->\n\n<!-- <center> A reviewer actually wrote this </center> -->\n\n<!-- . . . -->\n\n<!-- <br>  -->\n<!-- <br>  -->\n<!-- <center> We will offer them a magical test with 100% power -->\n<!-- <br>  -->\n<!-- <br>  -->\n<!-- just reject the null every time </center> -->\n\n  \n\n## Check inflation via simulations {background-image=assets/slide-background.svg}\n\n:::{.columns}\n  \n:::{.column width=40%}\n  \n<br>\nTWAS model\n<br>\n\n \n\\begin{align*}\nY &= \\beta ~ T +  \\epsilon_\\text{twas} \\\\\n\nT &= \\sum_k \\gamma_k ~ X_k \\quad \\epsilon_\\text{twas} \\perp\\!\\!\\!\\perp T\n\\end{align*}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbeta = 0\nN = 1000\nM = 999\nmaf=0.4\netwas = rnorm(N)\ngamma = rnorm(M)\nX = matrix(rbinom(N*M,2,maf),N,M)\nT = X %*% gamma \nY = beta * T + etwas\nfit = lm(Y ~ T)\n```\n:::\n\n\n\n:::\n\n\n:::{.column width=60%}\n\n:::{.fragment}\n\nlet's simulate the regression 1000 times\n<br>\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-1-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n::: {.fragment}\nNo inflation\n:::\n\n\n:::\n\n:::\n\n\n\n\n## What if we use a noisy predictor? {background-image=assets/slide-background.svg}\n\n:::{.columns}\n  \n:::{.column width=40%}\n  \n<br>\nTWAS model\n<br>\n\n \n\\begin{align*}\nY &= \\beta ~ T +  \\epsilon_\\text{twas} \\\\\n\n\\tilde{T} &= \\sum_k (\\gamma_k + e) ~ X_k \\\\\n\ne &\\perp\\!\\!\\!\\perp Y \\quad \\epsilon_\\text{twas} \\perp\\!\\!\\!\\perp T\n\\end{align*}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbeta = 0\nN = 1000\nM = 999\nmaf=0.4\netwas = rnorm(N)\ngamma = rnorm(M)\ne = rnorm(M)\nX = matrix(rbinom(N*M,2,maf),N,M)\nTtilde = X %*% (gamma + e)\nY = beta * Ttilde + etwas\nfit = lm(Y ~ Ttilde)\n```\n:::\n\n\n\n:::\n\n\n:::{.column width=60%}\n\n:::{.fragment}\n\nlet's simulate the regression 1000 times\n<br>\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n::: {.fragment}\nNo inflation\n:::\n\n::: {.fragment}\nif error in T is independent of Y, \n\nthere is no reason to see inflation \n:::\n\n:::\n\n:::\n\n\n\n\n\n\n\n\n## Leeuw et al’s \"reformulated null hypothesis\" {background-image=assets/slide-background.svg}\n\n\n\n\n$$  Y = \\beta ~ T +  \\epsilon_\\text{twas} $$\n$$  T = \\sum_k \\gamma_k ~ X_k $$\n\n\n\n$$H_0\\!:~ \\beta = 0$$\n\n. . . \n\nLeeuw et al claim that this is equivalent to\n\n$$H_0\\!:~ \\hat\\beta  = 0$$\n\n. . .\n\n\nThis is not hypothesis testing is done. \\{$\\hat\\beta=0$\\} is an event with probability 0.\n\n. . . \n\nPremise is wrong, and the conclusion is wrong\n\nWe can dismiss the report that error in prediction invalidates \\*WAS\n\n\n\n## The story doesn't end there, joint work with {.nostretch background-image=assets/slide-background.svg}\n\n![](assets/yanyu-and-festus.png){width=65%}\n\n\n## Let's revisit the simulation using polygenic Y {.nostretch background-image=assets/slide-background.svg}\n\n:::{.columns}\n  \n:::{.column width=40%}\n\n\\begin{align*}\n\nY &= \\beta ~ T + \\epsilon_\\text{twas}\\\\\n\n\\epsilon_\\text{twas} &= \\sum_k X_k ~ \\delta_k + \\epsilon \\\\\n\nT &= \\sum_k \\gamma_k ~ X_k \\\\\n\n\\epsilon, ~\\gamma,~ \\delta &  \\perp\\!\\!\\!\\perp ~ \\therefore ~ T \\perp\\!\\!\\!\\perp \\epsilon_\\text{twas}\n\n\n\\end{align*}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbeta = 0\nN = 1000\nM = 999\nmaf=0.4\nepsi = rnorm(N)\ngamma = rnorm(M)\ndelta = rnorm(M)\nX = matrix(rbinom(N*M,2,maf),N,M)\nT = X %*% gamma \nY = beta * T + X %*% delta + epsi\nfit = lm(Y ~ T)\n```\n:::\n\n\n\n:::\n\n\n:::{.column width=60%}\n\n:::{.fragment}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-3-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n::: {.fragment}\n\nNow we do see inflation\n\n:::\n\n\n:::\n\n:::\n\n## How does inflation vary with sample size? {background-image=assets/slide-background.svg}\n\n![](assets/twas-null-echi2-vs-nsam.png)\n\n\n## How does inflation vary with heritability of Y? {background-image=assets/slide-background.svg}\n\n![](assets/twas-null-echi2-vs-h2.png)\n\n## How does inflation vary with the number of SNPs? {background-image=assets/slide-background.svg}\n\n![](assets/twas-null-echi2-vs-msnp.png)\n\n\n## What does the inflation look like {background-image=assets/slide-background.svg}\n\n$$ E \\chi^2 \\propto N h^2 \\frac{1}{M} ?$$\n\n\n:::{.incremental}\n- if we do the math, we get\n$$ E \\chi^2 \\approx\n1 +  N ~ h^2 ~\\left ( \\frac{\\tilde\\gamma' \\cdot \\Sigma^2  \\cdot \\tilde\\gamma}{\\tilde\\gamma' \\cdot  \\Sigma  \\cdot \\tilde\\gamma} \\frac{1}{M} \\right )$$\n\n\n- we define the inflation factor $\\Phi$ as\n$$ \\Phi  = \\frac{\\tilde\\gamma' \\cdot \\Sigma^2  \\cdot \\tilde\\gamma}{\\tilde\\gamma' \\cdot  \\Sigma  \\cdot \\tilde\\gamma} \\frac{1}{M} $$\n- when SNPs are independent\n$\\Phi = \\frac{1}{M}$ we get the expression we guessed\n $E \\chi^2 = 1 + N h^2 \\frac{1}{M}$\n:::\n\n\n\n## What are the properties of the inflation factor  {background-image=assets/slide-background.svg visibility=hidden}\n\n:::{.incremental}\n\n- upper and lower bounds are $$\\frac{1}{M} \\le \\Phi \\le 1$$\n\n- lower bound attained when SNPs are independent\n\n- upper bound attained when SNPs are perfectly correlated\n\n- $\\Phi = \\frac{\\text{tr}(\\Sigma^2)}{M^2}$ if mediator is also polygenic\n\n:::\n\n\n\n## We can derive a more general expression {background-image=assets/slide-background.svg}\n\nfor the TWAS χ2 Statistic with Polygenic Y & Noisy Mediator \n\n<br><br>\n\n$$E~\\chi^2_\\text{twas} \\approx 1  + N ~h^2_\\delta ~ \\frac{\\Phi(\\text{gene})}{1 - \\beta^2\\tau^2} +  N ~ \\frac{\\beta^2 }{1 - \\beta^2\\tau^2}~\\tau^2$$\n<br><br>\n<br><br>\nwhere the precision\n$\\tau^2 = \\text{signal to noise ratio} = \\frac{\\text{var}(T)}{\\text{var}(\\tilde{T})}$\n\n\n<!-- ## Alternative χ2 with Polygenic Y and Noisy Mediator {background-image=assets/slide-background.svg} -->\n\n<!-- ![](assets/alternative-chi2-polygenic-Y-noisy-T.png) -->\n\n## Dependence on Precision of Predictor {background-image=assets/slide-background.svg}\n\n![](assets/inflation-vs-precision.png)\n\n## Can we correct the inflation? {background-image=assets/slide-background.svg}\n\n::: {.incremental}\n\n<br>\n\n- Yes!\n<br>\n\n- Calculate the non centrality parameter\n<br>\n\n- Use noncentral χ2 to compute p-values\n<br>\n\n- $\\texttt{pchisq(chi2, ncp=N*h2Y*phi, df=1, lower.tail=FALSE)}$\n\n:::\n\n## Estimated Factor Φ for Genes, Metabolites, Brain Features  {background-image=assets/slide-background.svg .nostretch}\n\n![](assets/phi-distribution.png){width=85%}\n\n$\\Phi$ values will be included in the prediction weight databases and correction added to the PrediXcan software\n\n\n## Take home message {background-image=assets/slide-background.svg}\n<br>\n\n\n::: {.columns}\n\n:::{.column width=75%}\n:::{.incremental}\n- Standard TWAS can yield inflated p-values when the trait is highly polygenic\n- Inflation can be corrected by simply using the noncentral χ2 distribution when calculating the p-values\n- Error in prediction does not cause inflation (under reasonable assumptions)\n- Noisy predictors can be used which will reduce false negatives, as long as the type I error is controlled\n:::\n\n:::\n\n:::\n\n\n# Thank you {background-color=\"white\"}\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}